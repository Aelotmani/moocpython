    
    
    
    

    

    \hypertarget{essayez-vous-muxeame}{%
\section{Essayez vous-même}\label{essayez-vous-muxeame}}

    \hypertarget{compluxe9ment---niveau-avancuxe9}{%
\subsection{Complément - niveau
avancé}\label{compluxe9ment---niveau-avancuxe9}}

    Pour des raisons techniques, il ne nous est pas possible de mettre en
ligne un notebook qui vous permette de reproduire les exemples de la
vidéo.

    C'est pourquoi, si vous êtes intéressés à reproduire vous-même les
expériences de la vidéo - à savoir, aller chercher plusieurs URLs de
manière séquentielle ou en parallèle - \href{data/async_http.py}{vous
pouvez télécharger le code fourni dans ce lien}.

    Il s'agit d'un simple script, qui reprend les 3 approches de la vidéo~:

\begin{itemize}
\tightlist
\item
  accès en séquence~;
\item
  accès asynchrones avec \texttt{fetch}~;
\item
  accès asynchrones avec \texttt{fetch2} (qui pour rappel provoque un
  tick à chaque ligne qui revient d'un des serveurs web).
\end{itemize}

À part pour l'appel à \texttt{sys.stdout.flush()}, ce code est
rigoureusement identique à celui utilisé dans la vidéo. On doit faire
ici cet appel à \texttt{flush()}, dans le mode avec \texttt{fetch2}, car
sinon les sorties de notre script sont bufferisées, et apparaissent
toutes ensemble à la fin du programme, c'est beaucoup moins drôle.

    Voici son mode d'emploi~:

    \begin{Shaded}
\begin{Highlighting}[frame=lines,framerule=0.6mm,rulecolor=\color{asisframecolor}]
\NormalTok{$ python3 async_http.py }\OperatorTok{--}\BuiltInTok{help}
\NormalTok{usage: async_http.py [}\OperatorTok{-}\NormalTok{h] [}\OperatorTok{-}\NormalTok{s] [}\OperatorTok{-}\NormalTok{d] [urls [urls ...]]}

\NormalTok{positional arguments:}
\NormalTok{  urls              URL}\StringTok{'s to be fetched}

\StringTok{optional arguments:}
\StringTok{  -h, --help        show this help message and exit}
\StringTok{  -s, --sequential  run sequentially}
\StringTok{  -d, --details     show details of lines as they show up (using fetch2)}
\end{Highlighting}
\end{Shaded}

    Et voici les chiffres que j'obtiens lorsque je l'utilise dans une
configuration réseau plus stable que dans la vidéo, on voit ici un réel
gain à l'utilisation de communications asynchrones~(à cause de
conditions réseau un peu erratiques lors de la vidéo, on n'y voit pas
bien le gain obtenu) :

    \begin{Shaded}
\begin{Highlighting}[frame=lines,framerule=0.6mm,rulecolor=\color{asisframecolor}]
\NormalTok{$ python3 async_http.py }\OperatorTok{-}\NormalTok{s}
\NormalTok{Running sequential mode on }\DecValTok{4}\NormalTok{ URLs}
\NormalTok{http:}\OperatorTok{//}\NormalTok{www.irs.gov}\OperatorTok{/}\NormalTok{pub}\OperatorTok{/}\NormalTok{irs}\OperatorTok{-}\NormalTok{pdf}\OperatorTok{/}\NormalTok{f1040.pdf returned }\DecValTok{179940}\NormalTok{ chars}
\NormalTok{http:}\OperatorTok{//}\NormalTok{www.irs.gov}\OperatorTok{/}\NormalTok{pub}\OperatorTok{/}\NormalTok{irs}\OperatorTok{-}\NormalTok{pdf}\OperatorTok{/}\NormalTok{f1040ez.pdf returned }\DecValTok{113242}\NormalTok{ chars}
\NormalTok{http:}\OperatorTok{//}\NormalTok{www.irs.gov}\OperatorTok{/}\NormalTok{pub}\OperatorTok{/}\NormalTok{irs}\OperatorTok{-}\NormalTok{pdf}\OperatorTok{/}\NormalTok{f1040es.pdf returned }\DecValTok{395201}\NormalTok{ chars}
\NormalTok{http:}\OperatorTok{//}\NormalTok{www.irs.gov}\OperatorTok{/}\NormalTok{pub}\OperatorTok{/}\NormalTok{irs}\OperatorTok{-}\NormalTok{pdf}\OperatorTok{/}\NormalTok{f1040sb.pdf returned }\DecValTok{73189}\NormalTok{ chars}
\NormalTok{duration }\OperatorTok{=} \FloatTok{9.80829906463623}\NormalTok{s}
\end{Highlighting}
\end{Shaded}

    \begin{Shaded}
\begin{Highlighting}[frame=lines,framerule=0.6mm,rulecolor=\color{asisframecolor}]
\NormalTok{$ python3 async_http.py}
\NormalTok{Running simple mode (fetch) on }\DecValTok{4}\NormalTok{ URLs}
\NormalTok{fetching http:}\OperatorTok{//}\NormalTok{www.irs.gov}\OperatorTok{/}\NormalTok{pub}\OperatorTok{/}\NormalTok{irs}\OperatorTok{-}\NormalTok{pdf}\OperatorTok{/}\NormalTok{f1040.pdf}
\NormalTok{fetching http:}\OperatorTok{//}\NormalTok{www.irs.gov}\OperatorTok{/}\NormalTok{pub}\OperatorTok{/}\NormalTok{irs}\OperatorTok{-}\NormalTok{pdf}\OperatorTok{/}\NormalTok{f1040sb.pdf}
\NormalTok{fetching http:}\OperatorTok{//}\NormalTok{www.irs.gov}\OperatorTok{/}\NormalTok{pub}\OperatorTok{/}\NormalTok{irs}\OperatorTok{-}\NormalTok{pdf}\OperatorTok{/}\NormalTok{f1040es.pdf}
\NormalTok{fetching http:}\OperatorTok{//}\NormalTok{www.irs.gov}\OperatorTok{/}\NormalTok{pub}\OperatorTok{/}\NormalTok{irs}\OperatorTok{-}\NormalTok{pdf}\OperatorTok{/}\NormalTok{f1040ez.pdf}
\NormalTok{http:}\OperatorTok{//}\NormalTok{www.irs.gov}\OperatorTok{/}\NormalTok{pub}\OperatorTok{/}\NormalTok{irs}\OperatorTok{-}\NormalTok{pdf}\OperatorTok{/}\NormalTok{f1040.pdf response status }\DecValTok{200}
\NormalTok{http:}\OperatorTok{//}\NormalTok{www.irs.gov}\OperatorTok{/}\NormalTok{pub}\OperatorTok{/}\NormalTok{irs}\OperatorTok{-}\NormalTok{pdf}\OperatorTok{/}\NormalTok{f1040ez.pdf response status }\DecValTok{200}
\NormalTok{http:}\OperatorTok{//}\NormalTok{www.irs.gov}\OperatorTok{/}\NormalTok{pub}\OperatorTok{/}\NormalTok{irs}\OperatorTok{-}\NormalTok{pdf}\OperatorTok{/}\NormalTok{f1040sb.pdf response status }\DecValTok{200}
\NormalTok{http:}\OperatorTok{//}\NormalTok{www.irs.gov}\OperatorTok{/}\NormalTok{pub}\OperatorTok{/}\NormalTok{irs}\OperatorTok{-}\NormalTok{pdf}\OperatorTok{/}\NormalTok{f1040es.pdf response status }\DecValTok{200}
\NormalTok{http:}\OperatorTok{//}\NormalTok{www.irs.gov}\OperatorTok{/}\NormalTok{pub}\OperatorTok{/}\NormalTok{irs}\OperatorTok{-}\NormalTok{pdf}\OperatorTok{/}\NormalTok{f1040sb.pdf returned }\DecValTok{75864} \BuiltInTok{bytes}
\NormalTok{http:}\OperatorTok{//}\NormalTok{www.irs.gov}\OperatorTok{/}\NormalTok{pub}\OperatorTok{/}\NormalTok{irs}\OperatorTok{-}\NormalTok{pdf}\OperatorTok{/}\NormalTok{f1040.pdf returned }\DecValTok{186928} \BuiltInTok{bytes}
\NormalTok{http:}\OperatorTok{//}\NormalTok{www.irs.gov}\OperatorTok{/}\NormalTok{pub}\OperatorTok{/}\NormalTok{irs}\OperatorTok{-}\NormalTok{pdf}\OperatorTok{/}\NormalTok{f1040ez.pdf returned }\DecValTok{117807} \BuiltInTok{bytes}
\NormalTok{http:}\OperatorTok{//}\NormalTok{www.irs.gov}\OperatorTok{/}\NormalTok{pub}\OperatorTok{/}\NormalTok{irs}\OperatorTok{-}\NormalTok{pdf}\OperatorTok{/}\NormalTok{f1040es.pdf returned }\DecValTok{409193} \BuiltInTok{bytes}
\NormalTok{duration }\OperatorTok{=} \FloatTok{2.211031913757324}\NormalTok{s}
\end{Highlighting}
\end{Shaded}

    N'hésitez pas à utiliser ceci comme base pour expérimenter.

Nous verrons en fin de semaine un autre exemple qui cette fois
illustrera l'interaction avec les sous-processus.


    % Add a bibliography block to the postdoc
    
    
    
